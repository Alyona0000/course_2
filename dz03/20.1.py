import numpy as np
import matplotlib.pyplot as plt

# =========================================================
# ФУНКЦІЯ побудови послідовності, графіка та ε-околу
# =========================================================
def analyze_sequence(name, a_n, eps=0.001):
    n = np.arange(1, len(a_n) + 1)
    b = a_n[-1]                     # гіпотезована границя
    diff = np.abs(a_n - b)
    mask = diff < eps
    k = np.argmax(mask)

    print(f"\n{name}")
    print("Гіпотеза границі b =", b)
    print("Починаючи з n =", k, "виконується |a_n - b| < ε")

    plt.figure(figsize=(9,5))
    plt.plot(n, a_n, 'o', markersize=2, label="a_n")
    plt.axhline(b, color="green", label=f"y=b={b:.5f}")

    plt.axhline(b + eps, color="red", linestyle="--")
    plt.axhline(b - eps, color="red", linestyle="--")
    plt.fill_between(n, b-eps, b+eps, color="red", alpha=0.1, label="ε-смуга")

    plt.axvline(k, color="purple", linestyle="--", label=f"k={k}")

    plt.title(name)
    plt.grid(True)
    plt.legend()
    plt.show()


# ================================
# КІЛЬКІСТЬ ЧЛЕНІВ
# ================================
N = 5000
n = np.arange(1, N+1)


# =========================================================
# (в)
# =========================================================
a_v = (n * n**(1/7) + (16*n**8)**0.25 + 5) / ((n + n**(1/3)) * n - 1)
analyze_sequence("(в)", a_v)

# =========================================================
# (г)
# =========================================================
a_g = (np.sqrt(n*(n**4+1)) - np.sqrt((n**3-1)*(n**2+2))) / np.sqrt(n)
analyze_sequence("(г)", a_g)

# =========================================================
# (д)
# =========================================================
a_d = ((2*n**4 + n**3 + 1 - n*(2*n+3))**(1/3)) / ((n+1)**(1/3))
analyze_sequence("(д)", a_d)

# =========================================================
# (е) — ОНОВЛЕНО! ✔️
#   S(n) = n + n/3 + n/9 + ... + n/3^n = (3/2)*n*(1 - 1/3^(n+1))
# =========================================================
S_n = (3/2) * n * (1 - (1/3)**(n+1))          # правильна геометрична сума
a_e = S_n * (n - 3) * n**(1/3) / (2*n**2 + 5) # саме сюди — нічого більше не треба
analyze_sequence("(е)", a_e)

# =========================================================
# (ж)
# =========================================================
a_zh = np.array([sum([((-1)**(k-1))*k for k in range(1, nn+1)]) / nn for nn in n])
analyze_sequence("(ж)", a_zh)

# =========================================================
# (з)
# =========================================================
a_z = (1 + 1/n)**n
analyze_sequence("(з)", a_z)

# =========================================================
# (і)
# =========================================================
frac_i = (5*n**2 + 7*n + 1) / (5*n**2 + 3*n + 6)
a_i = frac_i**(n-3)
analyze_sequence("(і)", a_i)

# =========================================================
# (и)
# =========================================================
a_y = 2*n*(np.sqrt(n**2 + 1) - n)
analyze_sequence("(и)", a_y)
